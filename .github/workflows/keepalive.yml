name: Keep Streamlit Alive
on:
  schedule:
    - cron: "*/10 * * * *"
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Wake and Ping Streamlit
        run: |
          BASE_URL="https://btdgenai.streamlit.app"
          echo "Checking $BASE_URL at $(date -u)"
          
          # 1️⃣ Try waking the app explicitly
          curl -X POST -L -s -o /dev/null -w "%{http_code}" "$BASE_URL/_stcore/wakeup" || echo "Wake-up attempt failed"
          
          # 2️⃣ Then ping main app page to keep it alive
          code=$(curl -L -s -o /dev/null -w "%{http_code}" "$BASE_URL")
          echo "Ping response: $code"
          
          if [[ "$code" != "200" ]]; then
            echo "App might still be booting. Retrying in 20s..."
            sleep 20
            curl -L -s -o /dev/null -w "%{http_code}" "$BASE_URL"
          fi
